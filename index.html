<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Te Tai Hou Teams – 2025</title>

<style>
/* --- General page setup --- */
body {
  font-family: "Segoe UI", Roboto, sans-serif;
  background-color: #f9fafb;
  margin: 0;
  padding: 20px;
  color: #333;
  display: flex;
  justify-content: center;
}

#page-wrapper { width: 100%; max-width: 75%; min-width: 320px; }

header { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 24px; }
header img { height: 60px; border-radius: 50%; }
header h1 { font-size: 1.8em; margin: 0; color: #1a365d; }

.controls {
  display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 12px;
}
.controls input, .controls select, .controls button {
  padding: 6px 10px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 0.95em;
}
.controls input:focus, .controls select:focus {
  outline: none; border-color: #2b6cb0; box-shadow: 0 0 4px rgba(43,108,176,0.3);
}
.controls button {
  background-color: #2b6cb0; color: white; cursor: pointer;
}
.controls button:hover { background-color: #1e4e8c; }

section { margin-bottom: 1rem; border-radius: 0.75rem; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.1); overflow: hidden; }
.group-header { font-weight: 600; font-size: 1.1rem; padding: 0.6rem 1rem; background: linear-gradient(to right, #ef4444, #f97316); color: #fff; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
.group-content { padding: 0; overflow-x: auto; transition: all 0.3s ease; }
.group-content.hidden { display: none; }

table { width: 100%; border-collapse: collapse; font-size: 0.9rem; table-layout: fixed; }
thead th { background: #f3f4f6; position: sticky; top: 0; z-index: 2; padding: 0.5rem; text-align: left; }
tbody td { border-top: 1px solid #e5e7eb; padding: 0.4rem 0.5rem; word-wrap: break-word; }
tbody tr:hover { background: #f9fafb; }

@media (max-width: 768px) {
  #page-wrapper { max-width: 100%; }
  table, thead, tbody, th, td, tr { display: block; }
  thead { display: none; }
  tr { margin-bottom: 12px; border-bottom: 1px solid #ddd; }
  tr:nth-child(odd) { background-color: #ffffff; }
  tr:nth-child(even) { background-color: #f2f4f7; }
  td { display: flex; justify-content: space-between; align-items: flex-start; padding: 6px 8px; word-break: break-word; overflow-wrap: anywhere; border-bottom: 1px dashed #eee; }
  td::before { content: attr(data-label); font-weight: 600; color: #2b6cb0; flex: 1; text-align: left; margin-right: 10px; white-space: nowrap; }
  td span { flex: 2; text-align: right; word-break: break-word; overflow-wrap: anywhere; white-space: normal; }
  td[data-label="Email"] span, td[data-label="Contact number"] span { text-align: right; word-break: break-all; overflow-wrap: anywhere; }
}
</style>
</head>

<body>
<div id="page-wrapper">
<header>
  <a href="https://www.poriruaheatbasketball.org" target="_blank">
    <img src="images/logo.png" alt="Porirua Heat Logo">
  </a>
  <h1>TE TAI HOU TEAMS – 2025 TERM 4</h1>
</header>

<div class="controls">
  <input id="search" type="text" placeholder="Search...">
  <select id="selectionFilter"><option value="">All Teams</option></select>
  <select id="clearedFilter"><option value="">All Cleared</option></select>
  <select id="gdRegFilter"><option value="">All GD Regist.</option></select>
  <button id="export">Export CSV</button>
  <button id="generatePDF">Generate PDF</button>
  <button id="toggleGroups">Collapse All</button>
</div>

<div id="table-container"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
const search = document.getElementById('search');
const selectionFilter = document.getElementById('selectionFilter');
const clearedFilter = document.getElementById('clearedFilter');
const gdRegFilter = document.getElementById('gdRegFilter');
const container = document.getElementById('table-container');
const exportBtn = document.getElementById('export');
const generatePDFBtn = document.getElementById('generatePDF');
const toggleGroupsBtn = document.getElementById('toggleGroups');

let headers = [];
let allRows = [];
let indicativeIndex = -1;
let clearedIndex = -1;
let gdRegIndex = -1;

const groupOrder = [
  "10U Dev","10U Elite","12U Dev","12U Elite",
  "14U Black","14U Orange","14U Blaze","14U Flames",
  "16U Dev","16U Elite","20U","Mens","Womens"
];

fetch('teams.csv')
  .then(res => res.text())
  .then(text => {
    const lines = text.trim().split('\n').map(l => l.split(','));
    headers = lines[0].map(h => h.trim());
    indicativeIndex = headers.findIndex(h => h.toLowerCase() === 'indicative selection');
    clearedIndex = headers.findIndex(h => h.toLowerCase() === 'cleared');
    gdRegIndex = headers.findIndex(h => h.toLowerCase() === 'gd regist.');
    allRows = lines.slice(1).map(r => r.map(c => c.trim()));
    // Remove Indicative Selection column from HTML display
    headers.splice(indicativeIndex, 1);
    allRows = allRows.map(r => { r.splice(indicativeIndex, 1); return r; });
    populateDropdowns();
    renderGroups(allRows);
  });

function populateDropdowns() {
  const teamValues = [...new Set(allRows.map(r => r[indicativeIndex] || ''))];
  const clearedValues = [...new Set(allRows.map(r => r[clearedIndex] || '(Blank)'))];
  const gdRegValues = [...new Set(allRows.map(r => r[gdRegIndex] || '(Blank)'))];

  [...groupOrder, ...teamValues.filter(v => !groupOrder.includes(v))].forEach(v => {
    const opt = document.createElement('option'); opt.value = v; opt.textContent = v;
    selectionFilter.appendChild(opt);
  });
  clearedValues.forEach(v => { const opt = document.createElement('option'); opt.value = v; opt.textContent = v; clearedFilter.appendChild(opt); });
  gdRegValues.forEach(v => { const opt = document.createElement('option'); opt.value = v; opt.textContent = v; gdRegFilter.appendChild(opt); });
}

function renderGroups(rows) {
  container.innerHTML = '';
  const groups = rows.reduce((acc,r)=>{const key=r[0]; (acc[key]??= []).push(r); return acc;}, {});
  const filterVal = selectionFilter.value;
  const allGroupKeys = Object.keys(groups);
  const visibleKeys = filterVal ? [filterVal] : [...groupOrder.filter(g=>allGroupKeys.includes(g)), ...allGroupKeys.filter(k=>!groupOrder.includes(k))];

  visibleKeys.forEach(groupName=>{
    const groupRows = groups[groupName]; if(!groupRows?.length) return;
    const section=document.createElement('section');
    const header=document.createElement('div'); header.className='group-header';
    header.innerHTML=`<span>${groupName}</span><span>(${groupRows.length}) ▼</span>`;
    section.appendChild(header);
    const wrapper=document.createElement('div'); wrapper.className='group-content';
    const table=document.createElement('table');
    const thead=document.createElement('thead'); const headerRow=document.createElement('tr');
    headers.forEach(h=>{const th=document.createElement('th'); th.textContent=h; headerRow.appendChild(th);});
    thead.appendChild(headerRow); table.appendChild(thead);
    const tbody=document.createElement('tbody');
    groupRows.forEach(r=>{const tr=document.createElement('tr'); r.forEach((c,i)=>{const td=document.createElement('td'); td.innerHTML=`<span>${c||''}</span>`; td.setAttribute('data-label',headers[i]); tr.appendChild(td);}); tbody.appendChild(tr);});
    table.appendChild(tbody); wrapper.appendChild(table); section.appendChild(wrapper); container.appendChild(section);
    header.addEventListener('click',()=>{wrapper.classList.toggle('hidden'); const arrow=header.querySelector('span:last-child'); arrow.textContent=wrapper.classList.contains('hidden')?`(${groupRows.length}) ▲`:`(${groupRows.length}) ▼`;});
  });
}

// ... Filters, export, toggleGroups remain same ...

// --- Generate PDF with logo at top of each page and player numbers ---
generatePDFBtn.addEventListener('click', () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'landscape' });
  const sections = container.querySelectorAll('section');
  const totalPages = sections.length;

  const logoImg = new Image();
  logoImg.src = 'images/logo.png';
  logoImg.onload = () => {
    sections.forEach((section, index) => {
      const groupName = section.querySelector('.group-header span:first-child').textContent;
      const table = section.querySelector('table');

      // All columns except Paid/Cleared and Indicative Selection (already removed in HTML)
      const headersForPDF = ['#'].concat(
        Array.from(table.querySelectorAll('thead th'))
          .map(th => th.textContent)
      );

      const dataForPDF = Array.from(table.querySelectorAll('tbody tr')).map((tr,i)=> 
        [i+1].concat(Array.from(tr.children).map(td => td.textContent))
      );

      if(index>0) doc.addPage();

      // Add logo at top left
      const aspectRatio = logoImg.width / logoImg.height;
      const logoHeight = 15; // mm
      const logoWidth = logoHeight * aspectRatio;
      doc.addImage(logoImg, 'PNG', 14, 10, logoWidth, logoHeight);

      doc.setFontSize(16);
      doc.text(`Team: ${groupName}`, 14 + logoWidth + 5, 20);

      doc.autoTable({
        head: [headersForPDF],
        body: dataForPDF,
        startY: 25 + logoHeight,
        theme: 'grid',
        styles: { fontSize: 10 },
        didDrawPage: function () {
          const page = doc.getCurrentPageInfo().pageNumber;
          doc.setFontSize(10);
          doc.text(`Page ${page} of ${totalPages}`, doc.internal.pageSize.width - 40, doc.internal.pageSize.height - 10);
        }
      });
    });

    doc.save('TeTaiHouTeams.pdf');
  };
});
</script>
</body>
</html>
