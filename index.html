<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Te Tai Hou Teams - 2025</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background-color: #fafafa; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; cursor: pointer; }
        tr:hover { background-color: #f9f9f9; }
        #search { margin-top: 20px; padding: 8px; width: 100%; max-width: 400px; }
        button { margin-top: 10px; padding: 6px 12px; }
    </style>
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: center; margin-top: 20px;">
        <img src="images/logo.png" alt="Te Tai Hou Logo" style="height: 80px; margin-right: 15px;">
        <h1 style="margin: 0;">Te Tai Hou Teams - 2025</h1>
    </div>
    <hr style="margin: 20px 0;">

    <input type="text" id="search" placeholder="Search table...">
    <table id="data-table"></table>
    <button id="export">Export Filtered Data</button>

    <script>
        const table = document.getElementById('data-table');
        const search = document.getElementById('search');
        const exportBtn = document.getElementById('export');

        let allRows = [];
        let sortColumn = null;
        let sortAsc = true;

        fetch('data/data.csv')
            .then(response => response.text())
            .then(text => {
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',');
                const rows = lines.slice(1).map(line => line.split(','));

                const headerRow = document.createElement('tr');
                headers.forEach((header, i) => {
                    const th = document.createElement('th');
                    th.textContent = header.trim();
                    th.addEventListener('click', () => sortTable(i));
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                allRows = rows;
                renderRows(allRows);
            });

        function renderRows(rows) {
            table.querySelectorAll('tr:not(:first-child)').forEach(tr => tr.remove());
            rows.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell.trim();
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
        }

        function sortTable(index) {
            if (sortColumn === index) sortAsc = !sortAsc; else { sortColumn = index; sortAsc = true; }
            const sorted = [...allRows].sort((a, b) => {
                const valA = a[index].toLowerCase();
                const valB = b[index].toLowerCase();
                if (valA < valB) return sortAsc ? -1 : 1;
                if (valA > valB) return sortAsc ? 1 : -1;
                return 0;
            });
            renderRows(sorted);
        }

        search.addEventListener('input', () => {
            const q = search.value.trim().toLowerCase();
            const filtered = allRows.filter(cols =>
                cols.some(c => c.toLowerCase().includes(q))
            );
            renderRows(filtered);
        });

        exportBtn.addEventListener('click', () => {
            const rows = Array.from(table.querySelectorAll('tr'));
            const csvContent = rows.map(r =>
                Array.from(r.children).map(td => td.textContent).join(',')
            ).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'filtered_data.csv';
            link.click();
        });
    </script>
</body>
</html>
