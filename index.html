<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Te Tai Hou Teams – 2025</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <header>
    <img src="logo.png" alt="Te Tai Hou Logo">
    <h1>Te Tai Hou Teams – 2025</h1>
  </header>

  <div class="controls">
    <label for="filter">Filter by Team:</label>
    <select id="filter">
      <option value="">All Teams</option>
    </select>
  </div>

  <div id="table-container"></div>

  <script>
    async function loadCSV() {
      const response = await fetch('teams.csv');
      const text = await response.text();
      const rows = text.trim().split('\n').map(r => r.split(','));

      const headers = rows.shift();
      const data = rows.map(r => {
        const obj = {};
        headers.forEach((h, i) => (obj[h.trim()] = r[i]?.trim()));
        return obj;
      }).filter(r => r["Indicative Selection"]); // exclude blanks

      const groups = {};
      data.forEach(row => {
        const group = row["Indicative Selection"];
        if (!groups[group]) groups[group] = [];
        groups[group].push(row);
      });

      // Custom sort order for groups
      const customOrder = ["Premier", "Senior", "Intermediate", "Junior"];
      const sortedGroups = Object.keys(groups).sort((a, b) => {
        const ai = customOrder.indexOf(a);
        const bi = customOrder.indexOf(b);
        if (ai === -1 && bi === -1) return a.localeCompare(b);
        if (ai === -1) return 1;
        if (bi === -1) return -1;
        return ai - bi;
      });

      const container = document.getElementById('table-container');
      container.innerHTML = "";

      sortedGroups.forEach(group => {
        const groupDiv = document.createElement('div');
        groupDiv.classList.add('group');

        const header = document.createElement('div');
        header.classList.add('group-header');
        header.textContent = group;
        header.onclick = () => content.classList.toggle('hidden');

        const content = document.createElement('div');
        content.classList.add('group-content');

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Contact Number</th>
            <th>Eligible Team</th>
          </tr>`;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        groups[group]
          .sort((a, b) => a["First Name"].localeCompare(b["First Name"]))
          .forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${r["First Name"]}</td>
              <td>${r["Last Name"]}</td>
              <td>${r["Email"]}</td>
              <td>${r["Contact Number"]}</td>
              <td>${r["Eligible Team"]}</td>`;
            tbody.appendChild(tr);
          });
        table.appendChild(tbody);
        content.appendChild(table);

        groupDiv.appendChild(header);
        groupDiv.appendChild(content);
        container.appendChild(groupDiv);
      });

      // Populate dropdown filter
      const filter = document.getElementById('filter');
      const teams = [...new Set(data.map(r => r["Eligible Team"]).filter(Boolean))].sort();
      teams.forEach(team => {
        const opt = document.createElement('option');
        opt.value = team;
        opt.textContent = team;
        filter.appendChild(opt);
      });

      // Filter function
      filter.addEventListener('change', e => {
        const selected = e.target.value;
        document.querySelectorAll('.group').forEach(groupDiv => {
          const rows = groupDiv.querySelectorAll('tbody tr');
          let visible = false;
          rows.forEach(row => {
            const team = row.cells[4].textContent.trim();
            const match = !selected || team === selected;
            row.style.display = match ? "" : "none";
            if (match) visible = true;
          });
          groupDiv.style.display = visible ? "" : "none";
        });
      });
    }

    loadCSV();
  </script>
</body>
</html>
